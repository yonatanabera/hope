"use client";import{useFocusRing as Ee}from"@react-aria/focus";import{useHover as Se}from"@react-aria/interactions";import{useVirtualizer as Ne}from"@tanstack/react-virtual";import F,{Fragment as Ie,createContext as me,createRef as ke,useCallback as ce,useContext as fe,useMemo as W,useReducer as Ue,useRef as Z,useState as He}from"react";import{flushSync as ee}from"react-dom";import{useActivePress as Ge}from'../../hooks/use-active-press.js';import{useByComparator as ze}from'../../hooks/use-by-comparator.js';import{useControllable as Ke}from'../../hooks/use-controllable.js';import{useDefaultValue as We}from'../../hooks/use-default-value.js';import{useDisposables as je}from'../../hooks/use-disposables.js';import{useElementSize as Pe}from'../../hooks/use-element-size.js';import{useEvent as c}from'../../hooks/use-event.js';import{useId as se}from'../../hooks/use-id.js';import{useInertOthers as $e}from'../../hooks/use-inert-others.js';import{useIsoMorphicEffect as X}from'../../hooks/use-iso-morphic-effect.js';import{useLatestValue as Xe}from'../../hooks/use-latest-value.js';import{useOnDisappear as Je}from'../../hooks/use-on-disappear.js';import{useOutsideClick as qe}from'../../hooks/use-outside-click.js';import{useOwnerDocument as Ae}from'../../hooks/use-owner.js';import{useRefocusableInput as Re}from'../../hooks/use-refocusable-input.js';import{useResolveButtonType as Ye}from'../../hooks/use-resolve-button-type.js';import{useScrollLock as Qe}from'../../hooks/use-scroll-lock.js';import{useSyncRefs as de}from'../../hooks/use-sync-refs.js';import{useTrackedPointer as Ze}from'../../hooks/use-tracked-pointer.js';import{transitionDataAttributes as et,useTransition as tt}from'../../hooks/use-transition.js';import{useTreeWalker as ot}from'../../hooks/use-tree-walker.js';import{useWatch as _e}from'../../hooks/use-watch.js';import{useDisabled as nt}from'../../internal/disabled.js';import{FloatingProvider as it,useFloatingPanel as rt,useFloatingPanelProps as lt,useFloatingReference as at,useResolvedAnchor as ut}from'../../internal/floating.js';import{FormFields as pt}from'../../internal/form-fields.js';import{Frozen as st,useFrozenData as he}from'../../internal/frozen.js';import{useProvidedId as dt}from'../../internal/id.js';import{OpenClosedProvider as bt,State as be,useOpenClosed as mt}from'../../internal/open-closed.js';import{history as Me}from'../../utils/active-element-history.js';import{isDisabledReactIssue7711 as ct}from'../../utils/bugs.js';import{Focus as I,calculateActiveIndex as De}from'../../utils/calculate-active-index.js';import{disposables as Fe}from'../../utils/disposables.js';import{sortByDomNode as ft}from'../../utils/focus-management.js';import{match as te}from'../../utils/match.js';import{isMobile as Tt}from'../../utils/platform.js';import{RenderFeatures as Ve,forwardRefWithAs as ne,mergeProps as Te,render as ie}from'../../utils/render.js';import{useDescribedBy as xt}from'../description/description.js';import{Keys as B}from'../keyboard.js';import{Label as gt,useLabelledBy as xe,useLabels as vt}from'../label/label.js';import{MouseButton as Le}from'../mouse.js';import{Portal as yt}from'../portal/portal.js';var Ot=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ot||{}),Ct=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(Ct||{}),Et=(o=>(o[o.Pointer=0]="Pointer",o[o.Focus=1]="Focus",o[o.Other=2]="Other",o))(Et||{}),St=(l=>(l[l.OpenCombobox=0]="OpenCombobox",l[l.CloseCombobox=1]="CloseCombobox",l[l.GoToOption=2]="GoToOption",l[l.SetTyping=3]="SetTyping",l[l.RegisterOption=4]="RegisterOption",l[l.UnregisterOption=5]="UnregisterOption",l[l.SetActivationTrigger=6]="SetActivationTrigger",l[l.UpdateVirtualConfiguration=7]="UpdateVirtualConfiguration",l[l.SetInputElement=8]="SetInputElement",l[l.SetButtonElement=9]="SetButtonElement",l[l.SetOptionsElement=10]="SetOptionsElement",l))(St||{});function ge(t,n=e=>e){let e=t.activeOptionIndex!==null?t.options[t.activeOptionIndex]:null,o=n(t.options.slice()),f=o.length>0&&o[0].dataRef.current.order!==null?o.sort((m,d)=>m.dataRef.current.order-d.dataRef.current.order):ft(o,m=>m.dataRef.current.domRef.current),b=e?f.indexOf(e):null;return b===-1&&(b=null),{options:f,activeOptionIndex:b}}let It={[1](t){var n;return(n=t.dataRef.current)!=null&&n.disabled||t.comboboxState===1?t:{...t,activeOptionIndex:null,comboboxState:1,isTyping:!1,activationTrigger:2,__demoMode:!1}},[0](t){var n,e;if((n=t.dataRef.current)!=null&&n.disabled||t.comboboxState===0)return t;if((e=t.dataRef.current)!=null&&e.value){let o=t.dataRef.current.calculateIndex(t.dataRef.current.value);if(o!==-1)return{...t,activeOptionIndex:o,comboboxState:0,__demoMode:!1}}return{...t,comboboxState:0,__demoMode:!1}},[3](t,n){return t.isTyping===n.isTyping?t:{...t,isTyping:n.isTyping}},[2](t,n){var b,m,d,T;if((b=t.dataRef.current)!=null&&b.disabled||t.optionsElement&&!((m=t.dataRef.current)!=null&&m.optionsPropsRef.current.static)&&t.comboboxState===1)return t;if(t.virtual){let{options:r,disabled:i}=t.virtual,l=n.focus===I.Specific?n.idx:De(n,{resolveItems:()=>r,resolveActiveIndex:()=>{var A,s;return(s=(A=t.activeOptionIndex)!=null?A:r.findIndex(V=>!i(V)))!=null?s:null},resolveDisabled:i,resolveId(){throw new Error("Function not implemented.")}}),S=(d=n.trigger)!=null?d:2;return t.activeOptionIndex===l&&t.activationTrigger===S?t:{...t,activeOptionIndex:l,activationTrigger:S,isTyping:!1,__demoMode:!1}}let e=ge(t);if(e.activeOptionIndex===null){let r=e.options.findIndex(i=>!i.dataRef.current.disabled);r!==-1&&(e.activeOptionIndex=r)}let o=n.focus===I.Specific?n.idx:De(n,{resolveItems:()=>e.options,resolveActiveIndex:()=>e.activeOptionIndex,resolveId:r=>r.id,resolveDisabled:r=>r.dataRef.current.disabled}),f=(T=n.trigger)!=null?T:2;return t.activeOptionIndex===o&&t.activationTrigger===f?t:{...t,...e,isTyping:!1,activeOptionIndex:o,activationTrigger:f,__demoMode:!1}},[4]:(t,n)=>{var b,m,d;if((b=t.dataRef.current)!=null&&b.virtual)return{...t,options:[...t.options,n.payload]};let e=n.payload,o=ge(t,T=>(T.push(e),T));t.activeOptionIndex===null&&(m=t.dataRef.current)!=null&&m.isSelected(n.payload.dataRef.current.value)&&(o.activeOptionIndex=o.options.indexOf(e));let f={...t,...o,activationTrigger:2};return(d=t.dataRef.current)!=null&&d.__demoMode&&t.dataRef.current.value===void 0&&(f.activeOptionIndex=0),f},[5]:(t,n)=>{var o;if((o=t.dataRef.current)!=null&&o.virtual)return{...t,options:t.options.filter(f=>f.id!==n.id)};let e=ge(t,f=>{let b=f.findIndex(m=>m.id===n.id);return b!==-1&&f.splice(b,1),f});return{...t,...e,activationTrigger:2}},[6]:(t,n)=>t.activationTrigger===n.trigger?t:{...t,activationTrigger:n.trigger},[7]:(t,n)=>{var o,f;if(t.virtual===null)return{...t,virtual:{options:n.options,disabled:(o=n.disabled)!=null?o:()=>!1}};if(t.virtual.options===n.options&&t.virtual.disabled===n.disabled)return t;let e=t.activeOptionIndex;if(t.activeOptionIndex!==null){let b=n.options.indexOf(t.virtual.options[t.activeOptionIndex]);b!==-1?e=b:e=null}return{...t,activeOptionIndex:e,virtual:{options:n.options,disabled:(f=n.disabled)!=null?f:()=>!1}}},[8]:(t,n)=>t.inputElement===n.element?t:{...t,inputElement:n.element},[9]:(t,n)=>t.buttonElement===n.element?t:{...t,buttonElement:n.element},[10]:(t,n)=>t.optionsElement===n.element?t:{...t,optionsElement:n.element}},ve=me(null);ve.displayName="ComboboxActionsContext";function re(t){let n=fe(ve);if(n===null){let e=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,re),e}return n}let Be=me(null);function Pt(t){let n=oe("VirtualProvider"),{options:e}=n.virtual,[o,f]=W(()=>{let r=n.optionsElement;if(!r)return[0,0];let i=window.getComputedStyle(r);return[parseFloat(i.paddingBlockStart||i.paddingTop),parseFloat(i.paddingBlockEnd||i.paddingBottom)]},[n.optionsElement]),b=Ne({enabled:e.length!==0,scrollPaddingStart:o,scrollPaddingEnd:f,count:e.length,estimateSize(){return 40},getScrollElement(){return n.optionsElement},overscan:12}),[m,d]=He(0);X(()=>{d(r=>r+1)},[e]);let T=b.getVirtualItems();return T.length===0?null:F.createElement(Be.Provider,{value:b},F.createElement("div",{style:{position:"relative",width:"100%",height:`${b.getTotalSize()}px`},ref:r=>{if(r){if(typeof process!="undefined"&&process.env.JEST_WORKER_ID!==void 0||n.activationTrigger===0)return;n.activeOptionIndex!==null&&e.length>n.activeOptionIndex&&b.scrollToIndex(n.activeOptionIndex)}}},T.map(r=>{var i;return F.createElement(Ie,{key:r.key},F.cloneElement((i=t.children)==null?void 0:i.call(t,{...t.slot,option:e[r.index]}),{key:`${m}-${r.key}`,"data-index":r.index,"aria-setsize":e.length,"aria-posinset":r.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${r.start}px)`,overflowAnchor:"none"}}))})))}let le=me(null);le.displayName="ComboboxDataContext";function oe(t){let n=fe(le);if(n===null){let e=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,oe),e}return n}function At(t,n){return te(n.type,It,t,n)}let Rt=Ie;function _t(t,n){var ye,Oe;let e=nt(),{value:o,defaultValue:f,onChange:b,form:m,name:d,by:T,disabled:r=e||!1,onClose:i,__demoMode:l=!1,multiple:S=!1,immediate:A=!1,virtual:s=null,nullable:V,...N}=t,_=We(f),[C=S?[]:void 0,x]=Ke(o,b,_),[P,v]=Ue(At,{dataRef:ke(),comboboxState:l?0:1,isTyping:!1,options:[],virtual:s?{options:s.options,disabled:(ye=s.disabled)!=null?ye:()=>!1}:null,activeOptionIndex:null,activationTrigger:2,inputElement:null,buttonElement:null,optionsElement:null,__demoMode:l}),M=Z(!1),y=Z({static:!1,hold:!1}),D=ze(T),j=c(p=>s?T===null?s.options.indexOf(p):s.options.findIndex(g=>D(g,p)):P.options.findIndex(g=>D(g.dataRef.current.value,p))),q=ce(p=>te(u.mode,{[1]:()=>C.some(g=>D(g,p)),[0]:()=>D(C,p)}),[C]),H=c(p=>P.activeOptionIndex===j(p)),u=W(()=>({...P,immediate:A,optionsPropsRef:y,value:C,defaultValue:_,disabled:r,mode:S?1:0,virtual:s?P.virtual:null,get activeOptionIndex(){if(M.current&&P.activeOptionIndex===null&&(s?s.options.length>0:P.options.length>0)){if(s){let g=s.options.findIndex(z=>{var pe,Ce;return!((Ce=(pe=s.disabled)==null?void 0:pe.call(s,z))!=null&&Ce)});if(g!==-1)return g}let p=P.options.findIndex(g=>!g.dataRef.current.disabled);if(p!==-1)return p}return P.activeOptionIndex},calculateIndex:j,compare:D,isSelected:q,isActive:H}),[C,_,r,S,l,P,s]);X(()=>{var p;s&&v({type:7,options:s.options,disabled:(p=s.disabled)!=null?p:null})},[s,s==null?void 0:s.options,s==null?void 0:s.disabled]),X(()=>{P.dataRef.current=u},[u]);let G=u.comboboxState===0;qe(G,[u.buttonElement,u.inputElement,u.optionsElement],()=>L.closeCombobox());let K=W(()=>{var p,g,z;return{open:u.comboboxState===0,disabled:r,activeIndex:u.activeOptionIndex,activeOption:u.activeOptionIndex===null?null:u.virtual?u.virtual.options[(p=u.activeOptionIndex)!=null?p:0]:(z=(g=u.options[u.activeOptionIndex])==null?void 0:g.dataRef.current.value)!=null?z:null,value:C}},[u,r,C]),O=c(()=>{if(u.activeOptionIndex!==null){if(L.setIsTyping(!1),u.virtual)Q(u.virtual.options[u.activeOptionIndex]);else{let{dataRef:p}=u.options[u.activeOptionIndex];Q(p.current.value)}L.goToOption(I.Specific,u.activeOptionIndex)}}),k=c(()=>{v({type:0}),M.current=!0}),Y=c(()=>{v({type:1}),M.current=!1,i==null||i()}),J=c(p=>{v({type:3,isTyping:p})}),h=c((p,g,z)=>(M.current=!1,p===I.Specific?v({type:2,focus:I.Specific,idx:g,trigger:z}):v({type:2,focus:p,trigger:z}))),ae=c((p,g)=>(v({type:4,payload:{id:p,dataRef:g}}),()=>{u.isActive(g.current.value)&&(M.current=!0),v({type:5,id:p})})),Q=c(p=>te(u.mode,{[0](){return x==null?void 0:x(p)},[1](){let g=u.value.slice(),z=g.findIndex(pe=>D(pe,p));return z===-1?g.push(p):g.splice(z,1),x==null?void 0:x(g)}})),ue=c(p=>{v({type:6,trigger:p})}),a=c(p=>{v({type:8,element:p})}),U=c(p=>{v({type:9,element:p})}),R=c(p=>{v({type:10,element:p})}),L=W(()=>({onChange:Q,registerOption:ae,goToOption:h,setIsTyping:J,closeCombobox:Y,openCombobox:k,setActivationTrigger:ue,selectActiveOption:O,setInputElement:a,setButtonElement:U,setOptionsElement:R}),[]),[E,w]=vt(),$=n===null?{}:{ref:n},we=ce(()=>{if(_!==void 0)return x==null?void 0:x(_)},[x,_]);return F.createElement(w,{value:E,props:{htmlFor:(Oe=u.inputElement)==null?void 0:Oe.id},slot:{open:u.comboboxState===0,disabled:r}},F.createElement(it,null,F.createElement(ve.Provider,{value:L},F.createElement(le.Provider,{value:u},F.createElement(bt,{value:te(u.comboboxState,{[0]:be.Open,[1]:be.Closed})},d!=null&&F.createElement(pt,{disabled:r,data:C!=null?{[d]:C}:{},form:m,onReset:we}),ie({ourProps:$,theirProps:N,slot:K,defaultTag:Rt,name:"Combobox"}))))))}let ht="input";function Mt(t,n){var J,h,ae,Q,ue;let e=oe("Combobox.Input"),o=re("Combobox.Input"),f=se(),b=dt(),{id:m=b||`headlessui-combobox-input-${f}`,onChange:d,displayValue:T,disabled:r=e.disabled||!1,autoFocus:i=!1,type:l="text",...S}=t,A=Z(null),s=de(A,n,at(),o.setInputElement),V=Ae(e.inputElement),N=je(),_=c(()=>{o.onChange(null),e.optionsElement&&(e.optionsElement.scrollTop=0),o.goToOption(I.Nothing)}),C=W(()=>{var a;return typeof T=="function"&&e.value!==void 0?(a=T(e.value))!=null?a:"":typeof e.value=="string"?e.value:""},[e.value,T]);_e(([a,U],[R,L])=>{if(e.isTyping)return;let E=A.current;E&&((L===0&&U===1||a!==R)&&(E.value=a),requestAnimationFrame(()=>{if(e.isTyping||!E||(V==null?void 0:V.activeElement)!==E)return;let{selectionStart:w,selectionEnd:$}=E;Math.abs(($!=null?$:0)-(w!=null?w:0))===0&&w===0&&E.setSelectionRange(E.value.length,E.value.length)}))},[C,e.comboboxState,V,e.isTyping]),_e(([a],[U])=>{if(a===0&&U===1){if(e.isTyping)return;let R=A.current;if(!R)return;let L=R.value,{selectionStart:E,selectionEnd:w,selectionDirection:$}=R;R.value="",R.value=L,$!==null?R.setSelectionRange(E,w,$):R.setSelectionRange(E,w)}},[e.comboboxState]);let x=Z(!1),P=c(()=>{x.current=!0}),v=c(()=>{N.nextFrame(()=>{x.current=!1})}),M=c(a=>{switch(o.setIsTyping(!0),a.key){case B.Enter:if(e.comboboxState!==0||x.current)return;if(a.preventDefault(),a.stopPropagation(),e.activeOptionIndex===null){o.closeCombobox();return}o.selectActiveOption(),e.mode===0&&o.closeCombobox();break;case B.ArrowDown:return a.preventDefault(),a.stopPropagation(),te(e.comboboxState,{[0]:()=>o.goToOption(I.Next),[1]:()=>o.openCombobox()});case B.ArrowUp:return a.preventDefault(),a.stopPropagation(),te(e.comboboxState,{[0]:()=>o.goToOption(I.Previous),[1]:()=>{ee(()=>o.openCombobox()),e.value||o.goToOption(I.Last)}});case B.Home:if(a.shiftKey)break;return a.preventDefault(),a.stopPropagation(),o.goToOption(I.First);case B.PageUp:return a.preventDefault(),a.stopPropagation(),o.goToOption(I.First);case B.End:if(a.shiftKey)break;return a.preventDefault(),a.stopPropagation(),o.goToOption(I.Last);case B.PageDown:return a.preventDefault(),a.stopPropagation(),o.goToOption(I.Last);case B.Escape:return e.comboboxState!==0?void 0:(a.preventDefault(),e.optionsElement&&!e.optionsPropsRef.current.static&&a.stopPropagation(),e.mode===0&&e.value===null&&_(),o.closeCombobox());case B.Tab:if(e.comboboxState!==0)return;e.mode===0&&e.activationTrigger!==1&&o.selectActiveOption(),o.closeCombobox();break}}),y=c(a=>{d==null||d(a),e.mode===0&&a.target.value===""&&_(),o.openCombobox()}),D=c(a=>{var R,L,E;let U=(R=a.relatedTarget)!=null?R:Me.find(w=>w!==a.currentTarget);if(!((L=e.optionsElement)!=null&&L.contains(U))&&!((E=e.buttonElement)!=null&&E.contains(U))&&e.comboboxState===0)return a.preventDefault(),e.mode===0&&e.value===null&&_(),o.closeCombobox()}),j=c(a=>{var R,L,E;let U=(R=a.relatedTarget)!=null?R:Me.find(w=>w!==a.currentTarget);(L=e.buttonElement)!=null&&L.contains(U)||(E=e.optionsElement)!=null&&E.contains(U)||e.disabled||e.immediate&&e.comboboxState!==0&&N.microTask(()=>{ee(()=>o.openCombobox()),o.setActivationTrigger(1)})}),q=xe(),H=xt(),{isFocused:u,focusProps:G}=Ee({autoFocus:i}),{isHovered:K,hoverProps:O}=Se({isDisabled:r}),k=W(()=>({open:e.comboboxState===0,disabled:r,hover:K,focus:u,autofocus:i}),[e,K,u,i,r]),Y=Te({ref:s,id:m,role:"combobox",type:l,"aria-controls":(J=e.optionsElement)==null?void 0:J.id,"aria-expanded":e.comboboxState===0,"aria-activedescendant":e.activeOptionIndex===null?void 0:e.virtual?(h=e.options.find(a=>!a.dataRef.current.disabled&&e.compare(a.dataRef.current.value,e.virtual.options[e.activeOptionIndex])))==null?void 0:h.id:(ae=e.options[e.activeOptionIndex])==null?void 0:ae.id,"aria-labelledby":q,"aria-describedby":H,"aria-autocomplete":"list",defaultValue:(ue=(Q=t.defaultValue)!=null?Q:e.defaultValue!==void 0?T==null?void 0:T(e.defaultValue):null)!=null?ue:e.defaultValue,disabled:r||void 0,autoFocus:i,onCompositionStart:P,onCompositionEnd:v,onKeyDown:M,onChange:y,onFocus:j,onBlur:D},G,O);return ie({ourProps:Y,theirProps:S,slot:k,defaultTag:ht,name:"Combobox.Input"})}let Dt="button";function Ft(t,n){var M;let e=oe("Combobox.Button"),o=re("Combobox.Button"),f=de(n,o.setButtonElement),b=se(),{id:m=`headlessui-combobox-button-${b}`,disabled:d=e.disabled||!1,autoFocus:T=!1,...r}=t,i=Re(e.inputElement),l=c(y=>{switch(y.key){case B.Space:case B.Enter:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&ee(()=>o.openCombobox()),i();return;case B.ArrowDown:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&(ee(()=>o.openCombobox()),e.value||o.goToOption(I.First)),i();return;case B.ArrowUp:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&(ee(()=>o.openCombobox()),e.value||o.goToOption(I.Last)),i();return;case B.Escape:if(e.comboboxState!==0)return;y.preventDefault(),e.optionsElement&&!e.optionsPropsRef.current.static&&y.stopPropagation(),ee(()=>o.closeCombobox()),i();return;default:return}}),S=c(y=>{y.preventDefault(),!ct(y.currentTarget)&&(y.button===Le.Left&&(e.comboboxState===0?o.closeCombobox():o.openCombobox()),i())}),A=xe([m]),{isFocusVisible:s,focusProps:V}=Ee({autoFocus:T}),{isHovered:N,hoverProps:_}=Se({isDisabled:d}),{pressed:C,pressProps:x}=Ge({disabled:d}),P=W(()=>({open:e.comboboxState===0,active:C||e.comboboxState===0,disabled:d,value:e.value,hover:N,focus:s}),[e,N,s,C,d]),v=Te({ref:f,id:m,type:Ye(t,e.buttonElement),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(M=e.optionsElement)==null?void 0:M.id,"aria-expanded":e.comboboxState===0,"aria-labelledby":A,disabled:d||void 0,autoFocus:T,onMouseDown:S,onKeyDown:l},V,_,x);return ie({ourProps:v,theirProps:r,slot:P,defaultTag:Dt,name:"Combobox.Button"})}let Vt="div",Lt=Ve.RenderStrategy|Ve.Static;function Bt(t,n){var k,Y,J;let e=se(),{id:o=`headlessui-combobox-options-${e}`,hold:f=!1,anchor:b,portal:m=!1,modal:d=!0,transition:T=!1,...r}=t,i=oe("Combobox.Options"),l=re("Combobox.Options"),S=ut(b);S&&(m=!0);let[A,s]=rt(S),V=lt(),N=de(n,S?A:null,l.setOptionsElement),_=Ae(i.optionsElement),C=mt(),[x,P]=tt(T,i.optionsElement,C!==null?(C&be.Open)===be.Open:i.comboboxState===0);Je(x,i.inputElement,l.closeCombobox);let v=i.__demoMode?!1:d&&i.comboboxState===0;Qe(v,_);let M=i.__demoMode?!1:d&&i.comboboxState===0;$e(M,{allowed:ce(()=>[i.inputElement,i.buttonElement,i.optionsElement],[i.inputElement,i.buttonElement,i.optionsElement])}),X(()=>{var h;i.optionsPropsRef.current.static=(h=t.static)!=null?h:!1},[i.optionsPropsRef,t.static]),X(()=>{i.optionsPropsRef.current.hold=f},[i.optionsPropsRef,f]),ot(i.comboboxState===0,{container:i.optionsElement,accept(h){return h.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:h.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(h){h.setAttribute("role","none")}});let y=xe([(k=i.buttonElement)==null?void 0:k.id]),D=W(()=>({open:i.comboboxState===0,option:void 0}),[i.comboboxState]),j=c(()=>{l.setActivationTrigger(0)}),q=c(h=>{h.preventDefault(),l.setActivationTrigger(0)}),H=Te(S?V():{},{"aria-labelledby":y,role:"listbox","aria-multiselectable":i.mode===1?!0:void 0,id:o,ref:N,style:{...r.style,...s,"--input-width":Pe(i.inputElement,!0).width,"--button-width":Pe(i.buttonElement,!0).width},onWheel:i.activationTrigger===0?void 0:j,onMouseDown:q,...et(P)}),u=x&&i.comboboxState===1,G=he(u,(Y=i.virtual)==null?void 0:Y.options),K=he(u,i.value),O=c(h=>i.compare(K,h));if(i.virtual){if(G===void 0)throw new Error("Missing `options` in virtual mode");Object.assign(r,{children:F.createElement(le.Provider,{value:G!==i.virtual.options?{...i,virtual:{...i.virtual,options:G}}:i},F.createElement(Pt,{slot:D},r.children))})}return F.createElement(yt,{enabled:m?t.static||x:!1},F.createElement(le.Provider,{value:i.mode===1?i:{...i,isSelected:O}},ie({ourProps:H,theirProps:{...r,children:F.createElement(st,{freeze:u},typeof r.children=="function"?(J=r.children)==null?void 0:J.call(r,D):r.children)},slot:D,defaultTag:Vt,features:Lt,visible:x,name:"Combobox.Options"})))}let wt="div";function Nt(t,n){var H,u,G,K;let e=oe("Combobox.Option"),o=re("Combobox.Option"),f=se(),{id:b=`headlessui-combobox-option-${f}`,value:m,disabled:d=(G=(u=(H=e.virtual)==null?void 0:H.disabled)==null?void 0:u.call(H,m))!=null?G:!1,order:T=null,...r}=t,i=Re(e.inputElement),l=e.virtual?e.activeOptionIndex===e.calculateIndex(m):e.activeOptionIndex===null?!1:((K=e.options[e.activeOptionIndex])==null?void 0:K.id)===b,S=e.isSelected(m),A=Z(null),s=Xe({disabled:d,value:m,domRef:A,order:T}),V=fe(Be),N=de(n,A,V?V.measureElement:null),_=c(()=>{o.setIsTyping(!1),o.onChange(m)});X(()=>o.registerOption(b,s),[s,b]);let C=Z(!(e.virtual||e.__demoMode));X(()=>{if(!e.virtual&&!e.__demoMode)return Fe().requestAnimationFrame(()=>{C.current=!0})},[e.virtual,e.__demoMode]),X(()=>{if(C.current&&e.comboboxState===0&&l&&e.activationTrigger!==0)return Fe().requestAnimationFrame(()=>{var O,k;(k=(O=A.current)==null?void 0:O.scrollIntoView)==null||k.call(O,{block:"nearest"})})},[A,l,e.comboboxState,e.activationTrigger,e.activeOptionIndex]);let x=c(O=>{O.preventDefault(),O.button===Le.Left&&(d||(_(),Tt()||requestAnimationFrame(()=>i()),e.mode===0&&o.closeCombobox()))}),P=c(()=>{if(d)return o.goToOption(I.Nothing);let O=e.calculateIndex(m);o.goToOption(I.Specific,O)}),v=Ze(),M=c(O=>v.update(O)),y=c(O=>{if(!v.wasMoved(O)||d||l)return;let k=e.calculateIndex(m);o.goToOption(I.Specific,k,0)}),D=c(O=>{v.wasMoved(O)&&(d||l&&(e.optionsPropsRef.current.hold||o.goToOption(I.Nothing)))}),j=W(()=>({active:l,focus:l,selected:S,disabled:d}),[l,S,d]);return ie({ourProps:{id:b,ref:N,role:"option",tabIndex:d===!0?void 0:-1,"aria-disabled":d===!0?!0:void 0,"aria-selected":S,disabled:void 0,onMouseDown:x,onFocus:P,onPointerEnter:M,onMouseEnter:M,onPointerMove:y,onMouseMove:y,onPointerLeave:D,onMouseLeave:D},theirProps:r,slot:j,defaultTag:wt,name:"Combobox.Option"})}let kt=ne(_t),Ut=ne(Ft),Ht=ne(Mt),Gt=gt,zt=ne(Bt),Kt=ne(Nt),ko=Object.assign(kt,{Input:Ht,Button:Ut,Label:Gt,Options:zt,Option:Kt});export{ko as Combobox,Ut as ComboboxButton,Ht as ComboboxInput,Gt as ComboboxLabel,Kt as ComboboxOption,zt as ComboboxOptions};
